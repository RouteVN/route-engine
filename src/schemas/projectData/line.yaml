$schema: http://json-schema.org/draft-07/schema#
title: Line Schema
description: Schema for individual story lines/steps in visual novel engine
type: object
properties:
  id:
    type: string
    description: Unique identifier for the line
  
  autoNext:
    type: object
    description: Auto-advancement behavior configuration
    properties:
      nextTrigger:
        type: string
        description: When to automatically advance
        enum: [onComplete, manual, fromComplete]
      delay:
        type: number
        description: Delay in milliseconds before auto-advance
        minimum: 0
      delayAfterComplete:
        type: number
        description: Delay after completion before auto-advance
        minimum: 0
      preventManual:
        type: boolean
        description: Whether to prevent manual advancement
        default: false
    additionalProperties: false
  
  presentation:
    $ref: "presentation.yaml"
    description: What to display/present for this line
  
  systemInstructions:
    type: object
    description: System commands to execute for this line
    properties:
      nextLine:
        type: object
        description: Advance to next line
        additionalProperties: false
      
      goToSectionScene:
        type: object
        description: Navigate to a different section/scene
        properties:
          sectionId:
            type: string
            description: Target section ID
          sceneId:
            type: string
            description: Target scene ID (optional)
          mode:
            type: string
            description: Navigation mode
        additionalProperties: false
      
      updateVariable:
        type: object
        description: Update game variables
        properties:
          operations:
            type: array
            description: Array of variable operations
            items:
              type: object
              properties:
                variableId:
                  type: string
                  description: ID of the variable to update
                op:
                  type: string
                  description: Operation to perform
                  enum: [set, add, subtract, multiply, divide, increment, decrement]
                value:
                  description: Value for the operation
                  oneOf:
                    - type: string
                    - type: number
                    - type: boolean
              required: [variableId, op]
              additionalProperties: false
        additionalProperties: false
      
      clearCurrentMode:
        type: object
        description: Clear current mode
        properties:
          mode:
            type: string
            description: Mode to clear
        additionalProperties: false
      
      toggleAutoMode:
        type: object
        description: Toggle auto-advancement mode
        additionalProperties: false
      
      toggleSkipMode:
        type: object
        description: Toggle skip mode
        additionalProperties: false
      
      toggleDialogueUIHidden:
        type: object
        description: Toggle dialogue UI visibility
        additionalProperties: false
      
      prevLine:
        type: object
        description: Go to previous step
        additionalProperties: false
      
      loadVnData:
        type: object
        description: Load game data
        properties:
          slotIndex:
            type: number
            description: Save slot index to load from
            minimum: 0
        required: [slotIndex]
        additionalProperties: false
      
      saveVnData:
        type: object
        description: Save game data
        properties:
          slotIndex:
            type: number
            description: Save slot index to save to
            minimum: 0
        required: [slotIndex]
        additionalProperties: false
    
    additionalProperties: false

required: [id]
additionalProperties: false
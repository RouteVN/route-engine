$schema: http://json-schema.org/draft-07/schema#
title: System State Schema
description: Schema for the visual novel engine system state
type: object
properties:
  pendingEffects:
    type: array
    description: Array of pending effects to be processed
    items:
      $ref: "effects.yaml"
    default: []

  variables:
    type: object
    description: Game variables and their current values
    additionalProperties:
      oneOf:
        - type: string
        - type: number
        - type: boolean
    default: {}

  saveData:
    type: object
    description: Additional save game data
    additionalProperties: true
    default: {}

  lastLineAction:
    type: object
    description: The last action executed
    additionalProperties: true

  dialogueUIHidden:
    type: boolean
    description: Whether the dialogue UI is currently hidden
    default: false

  autoMode:
    type: boolean
    description: Whether auto-advance mode is active
    default: false

  skipMode:
    type: boolean
    description: Whether skip mode is active
    default: false

  currentLanguagePackId:
    type: string
    description: ID of the currently active language pack

  history:
    type: object
    description: Navigation history
    properties:
      entries:
        type: array
        description: Array of history entries
        items:
          type: object
          properties:
            sectionId:
              type: string
              description: ID of the section
            lineId:
              type: string
              description: ID of the current line (only on latest entry)
          additionalProperties: false
        default: []
    required: [entries]
    additionalProperties: false
    default:
      entries: []

  globalAudios:
    type: array
    description: Array of global audio file IDs
    items:
      type: string
    default: []

  historyEntryIndex:
    type: integer
    description: Current index in history entries
    minimum: 0

  currentMode:
    type: string
    description: Current game mode
    enum: ["main", "replay"]
    default: "main"

  nextConfig:
    type: object
    description: Configuration for next line advancement
    properties:
      manual:
        type: object
        properties:
          enabled:
            type: boolean
            default: true
          requireComplete:
            type: boolean
            default: false
        additionalProperties: false
      auto:
        type: object
        properties:
          trigger:
            type: string
            enum: ["fromStart", "fromComplete"]
            default: "fromComplete"
          delay:
            type: number
            minimum: 0
            default: 1000
        required: [trigger, delay]
        additionalProperties: false
    additionalProperties: false
    default: {}

  modes:
    type: object
    description: Mode-specific state configurations
    properties:
      main:
        type: object
        description: Main game mode state
        properties:
          currentPointer:
            type: string
            enum: ["read", "history"]
            default: "read"
          modals:
            type: array
            description: Array of active modals
            items:
              type: string
            default: []
          read:
            type: object
            properties:
              sectionId:
                type: string
              lineId:
                type: string
            additionalProperties: false
          history:
            type: object
            properties:
              sectionId:
                type: string
              lineId:
                type: string
              historyEntryIndex:
                type: integer
                minimum: 0
            additionalProperties: false
        required: [currentPointer, modals, read, history]
        additionalProperties: false
      replay:
        type: object
        description: Replay mode state
        properties:
          currentPointer:
            type: string
            enum: ["read", "history"]
            default: "read"
          modals:
            type: array
            description: Array of active modals
            items:
              type: string
            default: []
          read:
            type: object
            properties:
              sectionId:
                type: string
              lineId:
                type: string
            additionalProperties: false
          history:
            type: object
            properties:
              sectionId:
                type: string
              lineId:
                type: string
              historyEntryIndex:
                type: integer
                minimum: 0
            additionalProperties: false
        required: [currentPointer, modals, read, history]
        additionalProperties: false
    required: [main, replay]
    additionalProperties: false

required: [variables, currentLanguagePackId, history, currentMode, modes]
additionalProperties: false


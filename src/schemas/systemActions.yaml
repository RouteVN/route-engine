$schema: http://json-schema.org/draft-07/schema#
title: System Actions Schema
description: Schema for all system actions that handle state management and navigation in visual novel engine
type: object
properties:
  nextLine:
    type: object
    description: Advance to next line
    properties:
      forceSkipAutonext:
        type: boolean
        description: Force skip auto-next behavior
        default: false
      targetMode:
        type: string
        description: Target mode for the next line operation
        enum: [main, replay]
    additionalProperties: false

  prevLine:
    type: object
    description: Go to previous line
    additionalProperties: false

  sectionTransition:
    type: object
    description: Navigate to specific scene/section
    properties:
      sectionId:
        type: string
        description: Target section ID
      sceneId:
        type: string
        description: Target scene ID (optional)
      mode:
        type: string
        description: Navigation mode
        enum: [read, menu, history, title]
      presetId:
        type: string
        description: Preset to use after navigation
    additionalProperties: false

  updateVariable:
    type: object
    description: Update game variables
    properties:
      operations:
        type: array
        description: Array of variable operations to perform
        items:
          type: object
          properties:
            variableId:
              type: string
              description: ID of the variable to update
            op:
              type: string
              description: Operation to perform on the variable
              enum: [set, add, subtract, multiply, divide, increment, decrement]
            value:
              description: Value to use in the operation
              oneOf:
                - type: string
                - type: number
                - type: boolean
          required: [variableId, op]
          additionalProperties: false
        minItems: 1
    required: [operations]
    additionalProperties: false

  setPreset:
    type: object
    description: Set the current preset for event handling
    properties:
      presetId:
        type: string
        description: ID of the preset to activate
    required: [presetId]
    additionalProperties: false

  clearCurrentMode:
    type: object
    description: Clear current mode and switch to a new one
    properties:
      mode:
        type: string
        description: Mode to switch to
        enum: [read, menu, history, title]
    required: [mode]
    additionalProperties: false

  startAutoMode:
    type: object
    description: Start auto-advance mode
    additionalProperties: false

  stopAutoMode:
    type: object
    description: Stop auto-advance mode
    additionalProperties: false

  toggleAutoMode:
    type: object
    description: Toggle auto-advance mode on/off
    additionalProperties: false

  startSkipMode:
    type: object
    description: Start skip mode for fast-forwarding
    additionalProperties: false

  stopSkipMode:
    type: object
    description: Stop skip mode
    additionalProperties: false

  toggleSkipMode:
    type: object
    description: Toggle skip mode on/off
    additionalProperties: false

  toggleDialogueUIHidden:
    type: object
    description: Toggle visibility of dialogue UI elements
    additionalProperties: false

  saveVnData:
    type: object
    description: Save current game state to a slot
    properties:
      slotIndex:
        type: number
        description: Save slot index to save to
        minimum: 0
    required: [slotIndex]
    additionalProperties: false

  loadVnData:
    type: object
    description: Load game state from a save slot
    properties:
      slotIndex:
        type: number
        description: Save slot index to load from
        minimum: 0
    required: [slotIndex]
    additionalProperties: false

  lineCompleted:
    type: object
    description: Handle completion of a line (internal action)
    additionalProperties: false

  clearPendingEffects:
    type: object
    description: Clear all pending effects (internal action)
    additionalProperties: false

  nextConfig:
    type: object
    description: Control how the line can be advanced
    properties:
      manual:
        type: object
        properties:
          enabled:
            type: boolean
            default: true
            description: Allow manual advance via user input
          requireComplete:
            type: boolean
            default: false
            description: Only allow manual advance after line completes
        additionalProperties: false
      auto:
        type: object
        description: Auto-advance configuration (presence enables it)
        properties:
          trigger:
            type: string
            enum: [fromStart, fromComplete]
            default: fromComplete
            description: When to start timing for auto advance
          delay:
            type: number
            minimum: 0
            default: 1000
            description: Delay in milliseconds before advancing
        required: [trigger, delay]
        additionalProperties: false
    additionalProperties: false

  addModal:
    type: object
    description: Add a modal to the display
    properties:
      resourceId:
        type: string
        description: ID of the modal resource to display
      resourceType:
        type: string
        description: Type of the modal resource
        default: layout
    required: [resourceId]
    additionalProperties: false

  clearLastModal:
    type: object
    description: Remove the last modal from the display
    additionalProperties: false

additionalProperties: false
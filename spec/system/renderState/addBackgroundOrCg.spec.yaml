file: "../../../src/stores/constructRenderState.js"
group: constructRenderState.addBackgroundOrCg
suites: [addBackgroundOrCg]
---
suite: addBackgroundOrCg
exportName: addBackgroundOrCg
---
case: add background image to story container
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children: []
    transitions: []
  - presentationState:
      background:
        resourceId: "bg1"
        resourceType: "image"
    resources:
      images:
        bg1:
          fileId: "image1.png"
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children:
        - id: "bg-cg-bg1"
          type: "sprite"
          x: 0
          y: 0
          url: "image1.png"
  transitions: []
---
case: add background with in animation
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children: []
    transitions: []
  - presentationState:
      background:
        resourceId: "bg1"
        resourceType: "image"
        animations:
          in:
            animationId: "fadeIn"
    resources:
      images:
        bg1:
          fileId: "image1.png"
      animations:
        fadeIn:
          properties:
            opacity: [0, 1]
            duration: 500
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children:
        - id: "bg-cg-bg1"
          type: "sprite"
          x: 0
          y: 0
          url: "image1.png"
  transitions:
    - id: "bg-cg-animation-in"
      type: "keyframes"
      event: "add"
      elementId: "bg-cg-bg1"
      properties:
        opacity: [0, 1]
        duration: 500
---
case: add background with update animation
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children:
          - id: "bg-cg-existing"
            type: "sprite"
            x: 0
            y: 0
            url: "old.jpg"
    transitions: []
  - presentationState:
      background:
        resourceId: "bg1"
        resourceType: "image"
        animations:
          update:
            animationId: "crossFade"
    resources:
      images:
        bg1:
          fileId: "new.jpg"
      animations:
        crossFade:
          properties:
            opacity: [1, 0]
            duration: 1000
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children:
        - id: "bg-cg-existing"
          type: "sprite"
          x: 0
          y: 0
          url: "old.jpg"
        - id: "bg-cg-bg1"
          type: "sprite"
          x: 0
          y: 0
          url: "new.jpg"
  transitions:
    - id: "bg-cg-animation-update"
      type: "keyframes"
      event: "update"
      elementId: "bg-cg-bg1"
      properties:
        opacity: [1, 0]
        duration: 1000
---
case: no presentationState.background - return unchanged state
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children: []
    transitions: []
  - presentationState: {}
    resources:
      images:
        bg1:
          fileId: "image1.png"
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children: []
  transitions: []
---
case: no resourceId in presentationState.background - return unchanged state
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children: []
    transitions: []
  - presentationState:
      background:
        someOtherProperty: "value"
    resources:
      images:
        bg1:
          fileId: "image1.png"
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children: []
  transitions: []
---
case: story container does not exist - return unchanged state
in:
  - elements:
      - id: "notStory"
        type: "container"
        children: []
    transitions: []
  - presentationState:
      background:
        resourceId: "bg1"
        resourceType: "image"
    resources:
      images:
        bg1:
          fileId: "image1.png"
out:
  elements:
    - id: "notStory"
      type: "container"
      children: []
  transitions: []
---
case: background image not found in resources - return unchanged state
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children: []
    transitions: []
  - presentationState:
      background:
        resourceId: "nonExistent"
        resourceType: "image"
    resources:
      images:
        bg1:
          fileId: "image1.png"
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children: []
  transitions: []
---
case: null resources - return unchanged state
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children: []
    transitions: []
  - presentationState:
      background:
        resourceId: "bg1"
        resourceType: "image"
    resources: {}
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children: []
  transitions: []
---
case: multiple backgrounds and animations
in:
  - elements:
      - id: "story"
        type: "container"
        x: 0
        y: 0
        children:
          - id: "existingChild"
            type: "text"
            content: "Hello"
    transitions:
      - id: "existingTransition"
        type: "existing"
  - presentationState:
      background:
        resourceId: "bg2"
        resourceType: "image"
        animations:
          in:
            animationId: "slideIn"
          update:
            animationId: "pulse"
    resources:
      images:
        bg2:
          fileId: "background.jpg"
      animations:
        slideIn:
          properties:
            x: [-100, 0]
            duration: 300
        pulse:
          properties:
            scale: [1, 1.1, 1]
            duration: 1000
out:
  elements:
    - id: "story"
      type: "container"
      x: 0
      y: 0
      children:
        - id: "existingChild"
          type: "text"
          content: "Hello"
        - id: "bg-cg-bg2"
          type: "sprite"
          x: 0
          y: 0
          url: "background.jpg"
  transitions:
    - id: "existingTransition"
      type: "existing"
    - id: "bg-cg-animation-in"
      type: "keyframes"
      event: "add"
      elementId: "bg-cg-bg2"
      properties:
        x: [-100, 0]
        duration: 300
    - id: "bg-cg-animation-update"
      type: "keyframes"
      event: "update"
      elementId: "bg-cg-bg2"
      properties:
        scale: [1, 1.1, 1]
        duration: 1000

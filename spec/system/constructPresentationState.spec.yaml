file: "../../src/stores/constructPresentationState.js"
group: constructPresentationState
suites: [constructPresentationState]
---
suite: constructPresentationState
exportName: constructPresentationState
---
case: construct presentation state with single base action
in:
  - - base:
        resourceId: "mainBase"
out:
  base:
    resourceId: "mainBase"
---
case: construct presentation state with multiple actions in one presentation
in:
  - - base:
        resourceId: "mainBase"
      background:
        resourceId: "bgImage"
      bgm:
        resourceId: "backgroundMusic"
        loop: true
out:
  base:
    resourceId: "mainBase"
  background:
    resourceId: "bgImage"
  bgm:
    resourceId: "backgroundMusic"
    loop: true
---
case: construct presentation state with clean all and multiple presentations
in:
  - - cleanAll: true
      base:
        resourceId: "oldBase"
    - base:
        resourceId: "newBase"
      background:
        resourceId: "newBg"
out:
  base:
    resourceId: "newBase"
  background:
    resourceId: "newBg"
---
case: dialogue characterId should be cleared when second presentation has undefined characterId
in:
  - - dialogue:
        mode: "adv"
        gui:
          resourceId: "simple-dialogue"
        characterId: "character-123"
        content:
          - text: "Hello"
    - dialogue:
        mode: "adv"
        gui:
          resourceId: "simple-dialogue"
out:
  dialogue:
    mode: "adv"
    gui:
      resourceId: "simple-dialogue"
    content:
      - text: "Hello"
---
case: clear background animations when next presentation has no background action
in:
  - - background:
        resourceId: "bg-school"
        animations:
          in:
            fade:
              duration: 500
    - dialogue:
        mode: "adv"
        content:
          - text: "Hello!"
out:
  background:
    resourceId: "bg-school"
    animations: {}
  dialogue:
    mode: "adv"
    content:
      - text: "Hello!"
---
case: clear character item animations when next presentation has no character action
in:
  - - character:
        items:
          - id: "sakura"
            resourceId: "char-sakura"
            animations:
              in:
                slide:
                  from: "left"
    - dialogue:
        mode: "adv"
        content:
          - text: "Nice to meet you!"
out:
  character:
    items:
      - id: "sakura"
        resourceId: "char-sakura"
        animations: {}
  dialogue:
    mode: "adv"
    content:
      - text: "Nice to meet you!"
---
case: clear visual item animations when next presentation has no visual action
in:
  - - visual:
        items:
          - id: "sparkle"
            resourceId: "effect-sparkle"
            animations:
              in:
                fade:
                  duration: 300
    - dialogue:
        mode: "adv"
        content:
          - text: "So beautiful!"
out:
  visual:
    items:
      - id: "sparkle"
        resourceId: "effect-sparkle"
        animations: {}
  dialogue:
    mode: "adv"
    content:
      - text: "So beautiful!"
---
case: preserve background without animations (no empty animations added)
in:
  - - background:
        resourceId: "bg-school"
    - dialogue:
        mode: "adv"
        content:
          - text: "Hello!"
out:
  background:
    resourceId: "bg-school"
  dialogue:
    mode: "adv"
    content:
      - text: "Hello!"
---
case: clear animations across multiple lines
in:
  - - background:
        resourceId: "bg-school"
        animations:
          in:
            fade:
              duration: 500
    - dialogue:
        mode: "adv"
        content:
          - text: "Line 2"
    - dialogue:
        content:
          - text: "Line 3"
out:
  background:
    resourceId: "bg-school"
    animations: {}
  dialogue:
    mode: "adv"
    content:
      - text: "Line 3"
---
case: clear only items with animations (mixed character items)
in:
  - - character:
        items:
          - id: "char-1"
            resourceId: "res-1"
            animations:
              in:
                fade: {}
          - id: "char-2"
            resourceId: "res-2"
    - dialogue:
        mode: "adv"
        content:
          - text: "Hello!"
out:
  character:
    items:
      - id: "char-1"
        resourceId: "res-1"
        animations: {}
      - id: "char-2"
        resourceId: "res-2"
  dialogue:
    mode: "adv"
    content:
      - text: "Hello!"
---
case: nvl-mode-lines-accumulate
in:
  - - dialogue:
        mode: "nvl"
        gui:
          resourceId: "nvl-layout"
        characterId: "narrator"
        content:
          - text: "First line"
    - dialogue:
        mode: "nvl"
        characterId: "alice"
        content:
          - text: "Second line"
    - dialogue:
        mode: "nvl"
        characterId: "bob"
        content:
          - text: "Third line"
out:
  dialogue:
    mode: "nvl"
    gui:
      resourceId: "nvl-layout"
    characterId: "bob"
    content:
      - text: "Third line"
    lines:
      - content:
          - text: "First line"
        characterId: "narrator"
      - content:
          - text: "Second line"
        characterId: "alice"
      - content:
          - text: "Third line"
        characterId: "bob"
---
case: nvl-mode-lines-accumulate-with-implicit-mode
in:
  - - dialogue:
        mode: "nvl"
        gui:
          resourceId: "nvl-layout"
        characterId: "narrator"
        content:
          - text: "First line"
    - dialogue:
        characterId: "alice"
        content:
          - text: "Second line"
    - dialogue:
        characterId: "bob"
        content:
          - text: "Third line"
out:
  dialogue:
    mode: "nvl"
    gui:
      resourceId: "nvl-layout"
    characterId: "bob"
    content:
      - text: "Third line"
    lines:
      - content:
          - text: "First line"
        characterId: "narrator"
      - content:
          - text: "Second line"
        characterId: "alice"
      - content:
          - text: "Third line"
        characterId: "bob"
---
case: nvl-mode-clearPage
in:
  - - dialogue:
        mode: "nvl"
        gui:
          resourceId: "nvl-layout"
        characterId: "narrator"
        content:
          - text: "First page line 1"
    - dialogue:
        mode: "nvl"
        characterId: "alice"
        content:
          - text: "First page line 2"
    - dialogue:
        mode: "nvl"
        clearPage: true
        characterId: "bob"
        content:
          - text: "Second page line 1"
out:
  dialogue:
    mode: "nvl"
    gui:
      resourceId: "nvl-layout"
    characterId: "bob"
    content:
      - text: "Second page line 1"
    lines:
      - content:
          - text: "Second page line 1"
        characterId: "bob"
---
case: nvl-mode-clearPage-with-content
in:
  - - dialogue:
        mode: "nvl"
        gui:
          resourceId: "nvl-layout"
        characterId: "alice"
        content:
          - text: "Old page content"
    - dialogue:
        mode: "nvl"
        clearPage: true
        content:
          - text: "New page starts here"
out:
  dialogue:
    mode: "nvl"
    gui:
      resourceId: "nvl-layout"
    content:
      - text: "New page starts here"
    lines:
      - content:
          - text: "New page starts here"
        characterId: null
---
case: nvl-mode-switch-from-adv
in:
  - - dialogue:
        mode: "adv"
        gui:
          resourceId: "adv-layout"
        characterId: "alice"
        content:
          - text: "ADV mode line"
    - dialogue:
        mode: "nvl"
        gui:
          resourceId: "nvl-layout"
        characterId: "narrator"
        content:
          - text: "First NVL line"
out:
  dialogue:
    mode: "nvl"
    gui:
      resourceId: "nvl-layout"
    characterId: "narrator"
    content:
      - text: "First NVL line"
    lines:
      - content:
          - text: "First NVL line"
        characterId: "narrator"
---
case: nvl-mode-switch-to-adv
in:
  - - dialogue:
        mode: "nvl"
        gui:
          resourceId: "nvl-layout"
        characterId: "narrator"
        content:
          - text: "NVL line"
    - dialogue:
        mode: "adv"
        gui:
          resourceId: "adv-layout"
        characterId: "alice"
        content:
          - text: "ADV line"
out:
  dialogue:
    mode: "adv"
    gui:
      resourceId: "adv-layout"
    characterId: "alice"
    content:
      - text: "ADV line"
    lines:
      - content:
          - text: "NVL line"
        characterId: "narrator"
---
case: nvl-mode-clearPage-adv-ignored
in:
  - - dialogue:
        mode: "adv"
        gui:
          resourceId: "adv-layout"
        characterId: "alice"
        content:
          - text: "First ADV line"
    - dialogue:
        mode: "adv"
        clearPage: true
        characterId: "bob"
        content:
          - text: "Second ADV line"
out:
  dialogue:
    mode: "adv"
    gui:
      resourceId: "adv-layout"
    characterId: "bob"
    content:
      - text: "Second ADV line"

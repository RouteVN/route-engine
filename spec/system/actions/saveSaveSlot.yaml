file: "../../../src/stores/system.store.js"
group: systemStore.saveSaveSlot
suites: [saveSaveSlot]
---
suite: saveSaveSlot
exportName: saveSaveSlot
---
case: save to slot 1
in:
  - state:
      global:
        saveSlots: {}
        pendingEffects: []
      projectData:
        story: { initialSceneId: "test" }
      contexts:
        - pointers:
            read: { sectionId: "sec1", lineId: "line1" }
  - slot: 1
out:
  global:
    saveSlots:
      "1":
        slotKey: "1"
        date: null
        image: null
        state:
          projectData:
            story: { initialSceneId: "test" }
          global:
            pendingEffects: []
          contexts:
            - pointers:
                read: { sectionId: "sec1", lineId: "line1" }
    pendingEffects:
      - name: "render"
  contexts:
    - pointers:
        read: { sectionId: "sec1", lineId: "line1" }
---
case: save to slot 2
in:
  - state:
      global:
        saveSlots: {}
        pendingEffects: []
      projectData:
        story: { initialSceneId: "test" }
      contexts:
        - pointers:
            read: { sectionId: "sec1", lineId: "line1" }
  - slot: 2
out:
  global:
    saveSlots:
      "2":
        slotKey: "2"
        date: null
        image: null
        state:
          projectData:
            story: { initialSceneId: "test" }
          global:
            pendingEffects: []
          contexts:
            - pointers:
                read: { sectionId: "sec1", lineId: "line1" }
    pendingEffects:
      - name: "render"
  contexts:
    - pointers:
        read: { sectionId: "sec1", lineId: "line1" }
---
case: overwrite existing save slot
in:
  - state:
      global:
        saveSlots:
          "1":
            slotKey: "1"
            date: 1704110400
            image: "old_image.png"
            state:
              level: 5
        pendingEffects: []
      projectData:
        story: { initialSceneId: "test" }
      contexts:
        - pointers:
            read: { sectionId: "sec1", lineId: "line1" }
  - slot: 1
out:
  global:
    saveSlots:
      "1":
        slotKey: "1"
        date: null
        image: null
        state:
          projectData:
            story: { initialSceneId: "test" }
          global:
            pendingEffects: []
          contexts:
            - pointers:
                read: { sectionId: "sec1", lineId: "line1" }
    pendingEffects:
      - name: "saveSlots"
        payload:
          saveSlots:
            "1":
              slotKey: "1"
              date: null
              image: null
              state:
                projectData:
                  story: { initialSceneId: "test" }
                global:
                  pendingEffects: []
                contexts:
                  - pointers:
                      read: { sectionId: "sec1", lineId: "line1" }
      - name: "render"
  contexts:
    - pointers:
        read: { sectionId: "sec1", lineId: "line1" }
---
case: save to slot with existing pending effects
in:
  - state:
      global:
        saveSlots: {}
        pendingEffects:
          - name: "existingEffect"
      projectData:
        story: { initialSceneId: "test" }
      contexts:
        - pointers:
            read: { sectionId: "sec1", lineId: "line1" }
  - slot: 1
out:
  global:
    saveSlots:
      "1":
        slotKey: "1"
        date: null
        image: null
        state:
          projectData:
            story: { initialSceneId: "test" }
          global:
            pendingEffects: []
          contexts:
            - pointers:
                read: { sectionId: "sec1", lineId: "line1" }
    pendingEffects:
      - name: "existingEffect"
      - name: "saveSlots"
        payload:
          saveSlots:
            "1":
              slotKey: "1"
              date: null
              image: null
              state:
                projectData:
                  story: { initialSceneId: "test" }
                global:
                  pendingEffects: []
                contexts:
                  - pointers:
                      read: { sectionId: "sec1", lineId: "line1" }
      - name: "render"
  contexts:
    - pointers:
        read: { sectionId: "sec1", lineId: "line1" }
---
case: save with context variables
in:
  - state:
      global:
        saveSlots: {}
        pendingEffects: []
        viewedRegistry:
          sections: ["sec1"]
          resources: []
      projectData:
        story: { initialSceneId: "test" }
      contexts:
        - pointers:
            read: { sectionId: "sec1", lineId: "line1" }
          variables:
            playerName: "Alice"
            score: 150
            soundEnabled: true
  - slot: 1
out:
  global:
    saveSlots:
      "1":
        slotKey: "1"
        date: null
        image: null
        state:
          viewedRegistry:
            sections: ["sec1"]
            resources: []
          contexts:
            - pointers:
                read: { sectionId: "sec1", lineId: "line1" }
              variables:
                playerName: "Alice"
                score: 150
                soundEnabled: true
    viewedRegistry:
      sections: ["sec1"]
      resources: []
    pendingEffects:
      - name: "saveSlots"
        payload:
          saveSlots:
            "1":
              slotKey: "1"
              date: null
              image: null
              state:
                viewedRegistry:
                  sections: ["sec1"]
                  resources: []
                contexts:
                  - pointers:
                      read: { sectionId: "sec1", lineId: "line1" }
                    variables:
                      playerName: "Alice"
                      score: 150
                      soundEnabled: true
      - name: "render"
  contexts:
    - pointers:
        read: { sectionId: "sec1", lineId: "line1" }
      variables:
        playerName: "Alice"
        score: 150
        soundEnabled: true

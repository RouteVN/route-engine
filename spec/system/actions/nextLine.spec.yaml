file: "../../../src/stores/system.store.js"
group: systemStore.nextLine
suites: [nextLine]
---
suite: nextLine
exportName: nextLine
---
case: complete line instantly when not completed (click during animation)
in:
  - state:
      global:
        isLineCompleted: false
        nextLineConfig:
          manual:
            enabled: true
        pendingEffects: []
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
out:
  global:
    isLineCompleted: true
    nextLineConfig:
      manual:
        enabled: true
    pendingEffects:
      - name: "clearNextLineConfigTimer"
      - name: "render"
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "1"
---
case: move to next line
in:
  - state:
      global:
        isLineCompleted: true
        nextLineConfig:
          manual:
            enabled: true
        pendingEffects: []
        viewedRegistry:
          sections: []
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
                    - id: "3"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
  - sectionId: "section1"
out:
  global:
    isLineCompleted: false
    nextLineConfig:
      manual:
        enabled: true
    pendingEffects:
      - name: "render"
      - name: "render"
      - name: "handleLineActions"
    viewedRegistry:
      sections:
        - sectionId: "section1"
          lastLineId: "1"
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
                - id: "3"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "2"
---
case: already at last line (no change)
in:
  - state:
      global:
        isLineCompleted: true
        nextLineConfig:
          manual:
            enabled: true
        pendingEffects: []
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "2"
  - sectionId: "section1"
out:
  global:
    isLineCompleted: true
    nextLineConfig:
      manual:
        enabled: true
    pendingEffects: []
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "2"
---
case: no section found
in:
  - state:
      global:
        isLineCompleted: true
        nextLineConfig:
          manual:
            enabled: true
        pendingEffects: []
      projectData:
        story:
          scenes:
            scene1:
              sections:
                otherSection:
                  lines:
                    - id: "1"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
  - sectionId: "section1"
out:
  global:
    isLineCompleted: true
    nextLineConfig:
      manual:
        enabled: true
    pendingEffects: []
  projectData:
    story:
      scenes:
        scene1:
          sections:
            otherSection:
              lines:
                - id: "1"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "1"
---
case: manual navigation disabled (no change)
in:
  - state:
      global:
        isLineCompleted: true
        nextLineConfig:
          manual:
            enabled: false
        pendingEffects: []
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
out:
  global:
    isLineCompleted: true
    nextLineConfig:
      manual:
        enabled: false
    pendingEffects: []
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "1"
---
case: skip mode stops at unviewed line when _skipUnseenText is undefined
in:
  - state:
      global:
        isLineCompleted: true
        skipMode: true
        variables: {}
        nextLineConfig:
          manual:
            enabled: true
        pendingEffects: []
        viewedRegistry:
          sections:
            - sectionId: "section1"
              lastLineId: "1"
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
out:
  global:
    isLineCompleted: true
    skipMode: false
    variables: {}
    nextLineConfig:
      manual:
        enabled: true
    pendingEffects:
      - name: "clearSkipNextTimer"
      - name: "render"
    viewedRegistry:
      sections:
        - sectionId: "section1"
          lastLineId: "1"
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "1"
---
case: skip mode stops at unviewed line when _skipUnseenText is false
in:
  - state:
      global:
        isLineCompleted: true
        skipMode: true
        variables:
          _skipUnseenText: false
        nextLineConfig:
          manual:
            enabled: true
        pendingEffects: []
        viewedRegistry:
          sections:
            - sectionId: "section1"
              lastLineId: "1"
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
out:
  global:
    isLineCompleted: true
    skipMode: false
    variables:
      _skipUnseenText: false
    nextLineConfig:
      manual:
        enabled: true
    pendingEffects:
      - name: "clearSkipNextTimer"
      - name: "render"
    viewedRegistry:
      sections:
        - sectionId: "section1"
          lastLineId: "1"
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "1"
---
case: skip mode continues when _skipUnseenText is true (skip all)
in:
  - state:
      global:
        isLineCompleted: true
        skipMode: true
        variables:
          _skipUnseenText: true
        nextLineConfig:
          manual:
            enabled: true
        pendingEffects: []
        viewedRegistry:
          sections:
            - sectionId: "section1"
              lastLineId: "1"
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
                    - id: "3"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
out:
  global:
    isLineCompleted: false
    skipMode: true
    variables:
      _skipUnseenText: true
    nextLineConfig:
      manual:
        enabled: true
    pendingEffects:
      - name: "render"
      - name: "render"
      - name: "handleLineActions"
    viewedRegistry:
      sections:
        - sectionId: "section1"
          lastLineId: "1"
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
                - id: "3"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "2"
---
case: complete line with scene mode (fromComplete) restarts scene timer
in:
  - state:
      global:
        isLineCompleted: false
        autoMode: false
        nextLineConfig:
          manual:
            enabled: true
          auto:
            enabled: true
            trigger: "fromComplete"
            delay: 2000
        pendingEffects: []
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
out:
  global:
    isLineCompleted: true
    autoMode: false
    nextLineConfig:
      manual:
        enabled: true
      auto:
        enabled: true
        trigger: "fromComplete"
        delay: 2000
    pendingEffects:
      - name: "clearNextLineConfigTimer"
      - name: "nextLineConfigTimer"
        payload:
          delay: 2000
      - name: "render"
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "1"
---
case: complete line with scene mode (fromStart) does not restart scene timer
in:
  - state:
      global:
        isLineCompleted: false
        autoMode: false
        nextLineConfig:
          manual:
            enabled: true
          auto:
            enabled: true
            trigger: "fromStart"
            delay: 1500
        pendingEffects: []
      projectData:
        story:
          scenes:
            scene1:
              sections:
                section1:
                  lines:
                    - id: "1"
                      actions: {}
                    - id: "2"
                      actions: {}
      contexts:
        - currentPointerMode: "read"
          pointers:
            read:
              sectionId: "section1"
              lineId: "1"
out:
  global:
    isLineCompleted: true
    autoMode: false
    nextLineConfig:
      manual:
        enabled: true
      auto:
        enabled: true
        trigger: "fromStart"
        delay: 1500
    pendingEffects:
      - name: "clearNextLineConfigTimer"
      - name: "render"
  projectData:
    story:
      scenes:
        scene1:
          sections:
            section1:
              lines:
                - id: "1"
                  actions: {}
                - id: "2"
                  actions: {}
  contexts:
    - currentPointerMode: "read"
      pointers:
        read:
          sectionId: "section1"
          lineId: "1"

file: "../../../src/stores/system.store.js"
group: systemStore.setNextLineConfig
suites: [setNextLineConfig]
---
suite: setNextLineConfig
exportName: setNextLineConfig
---
case: set complete next line config
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: false
          auto:
            trigger: "fromComplete"
            delay: 1000
        pendingEffects: []
  - manual:
      enabled: false
      requireComplete: true
    auto:
      trigger: "fromStart"
      delay: 2000
out:
  global:
    nextLineConfig:
      manual:
        enabled: false
        requireComplete: true
      auto:
        trigger: "fromStart"
        delay: 2000
    pendingEffects:
      - name: "render"
---
case: set partial next line config (only manual)
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: false
          auto:
            trigger: "fromComplete"
            delay: 1000
        pendingEffects: []
  - manual:
      enabled: false
      requireComplete: true
out:
  global:
    nextLineConfig:
      manual:
        enabled: false
        requireComplete: true
      auto:
        trigger: "fromComplete"
        delay: 1000
    pendingEffects:
      - name: "render"
---
case: set partial next line config (only auto)
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: false
          auto:
            trigger: "fromComplete"
            delay: 1000
        pendingEffects: []
  - auto:
      trigger: "fromStart"
      delay: 500
out:
  global:
    nextLineConfig:
      manual:
        enabled: true
        requireComplete: false
      auto:
        trigger: "fromStart"
        delay: 500
    pendingEffects:
      - name: "render"
---
case: set partial next line config (only applyMode)
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: false
          auto:
            trigger: "fromComplete"
            delay: 1000
          applyMode: "persistent"
        pendingEffects: []
  - applyMode: "singleLine"
out:
  global:
    nextLineConfig:
      manual:
        enabled: true
        requireComplete: false
      auto:
        trigger: "fromComplete"
        delay: 1000
      applyMode: "singleLine"
    pendingEffects:
      - name: "render"
---
case: set next line config with existing pending effects
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: false
          auto:
            trigger: "fromComplete"
            delay: 1000
        pendingEffects:
          - name: "existingEffect"
            data: "test"
  - manual:
      enabled: false
      requireComplete: false
    auto:
      trigger: "fromComplete"
      delay: 1500
out:
  global:
    nextLineConfig:
      manual:
        enabled: false
        requireComplete: false
      auto:
        trigger: "fromComplete"
        delay: 1500
    pendingEffects:
      - name: "existingEffect"
        data: "test"
      - name: "render"
---
case: set next line config to same values (idempotent)
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: true
          auto:
            trigger: "fromStart"
            delay: 3000
        pendingEffects: []
  - manual:
      enabled: true
      requireComplete: true
    auto:
      trigger: "fromStart"
      delay: 3000
out:
  global:
    nextLineConfig:
      manual:
        enabled: true
        requireComplete: true
      auto:
        trigger: "fromStart"
        delay: 3000
    pendingEffects:
      - name: "render"
---
case: set next line config with minimal values
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: false
          auto:
            trigger: "fromComplete"
            delay: 1000
        pendingEffects: []
  - manual:
      enabled: true
    auto:
      delay: 0
out:
  global:
    nextLineConfig:
      manual:
        enabled: true
      auto:
        delay: 0
    pendingEffects:
      - name: "render"
---
case: set next line config with other global properties unchanged
in:
  - state:
      global:
        nextLineConfig:
          manual:
            enabled: true
            requireComplete: false
          auto:
            trigger: "fromComplete"
            delay: 1000
        autoMode: true
        skipMode: false
        dialogueUIHidden: false
        currentLocalizationPackageId: "en"
        pendingEffects: []
  - manual:
      enabled: false
    auto:
      trigger: "fromStart"
      delay: 2000
out:
  global:
    nextLineConfig:
      manual:
        enabled: false
      auto:
        trigger: "fromStart"
        delay: 2000
    autoMode: true
    skipMode: false
    dialogueUIHidden: false
    currentLocalizationPackageId: "en"
    pendingEffects:
      - name: "render"
---
case: enable auto with trigger fromStart starts timer immediately
in:
  - state:
      global:
        isLineCompleted: false
        nextLineConfig:
          manual:
            enabled: true
          auto:
            enabled: false
        pendingEffects: []
  - auto:
      enabled: true
      trigger: "fromStart"
      delay: 1500
out:
  global:
    isLineCompleted: false
    nextLineConfig:
      manual:
        enabled: true
      auto:
        enabled: true
        trigger: "fromStart"
        delay: 1500
    pendingEffects:
      - name: "nextLineConfigTimer"
        payload:
          delay: 1500
      - name: "render"
---
case: enable auto with trigger fromComplete does not start timer when line not completed
in:
  - state:
      global:
        isLineCompleted: false
        nextLineConfig:
          manual:
            enabled: true
          auto:
            enabled: false
        pendingEffects: []
  - auto:
      enabled: true
      trigger: "fromComplete"
      delay: 2000
out:
  global:
    isLineCompleted: false
    nextLineConfig:
      manual:
        enabled: true
      auto:
        enabled: true
        trigger: "fromComplete"
        delay: 2000
    pendingEffects:
      - name: "render"
---
case: enable auto with trigger fromComplete starts timer when line already completed
in:
  - state:
      global:
        isLineCompleted: true
        nextLineConfig:
          manual:
            enabled: true
          auto:
            enabled: false
        pendingEffects: []
  - auto:
      enabled: true
      trigger: "fromComplete"
      delay: 2000
out:
  global:
    isLineCompleted: true
    nextLineConfig:
      manual:
        enabled: true
      auto:
        enabled: true
        trigger: "fromComplete"
        delay: 2000
    pendingEffects:
      - name: "nextLineConfigTimer"
        payload:
          delay: 2000
      - name: "render"
---
case: disable auto clears timer
in:
  - state:
      global:
        isLineCompleted: false
        nextLineConfig:
          manual:
            enabled: true
          auto:
            enabled: true
            trigger: "fromStart"
            delay: 1500
        pendingEffects: []
  - auto:
      enabled: false
out:
  global:
    isLineCompleted: false
    nextLineConfig:
      manual:
        enabled: true
      auto:
        enabled: false
    pendingEffects:
      - name: "clearNextLineConfigTimer"
      - name: "render"

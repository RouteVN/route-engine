file: "../../../src/stores/system.store.js"
group: systemStore.addToHistorySequence
suites: [addToHistorySequence]
---
suite: addToHistorySequence
exportName: addToHistorySequence
---
case: add item to history with empty history and captures initialState
in:
  - state:
      global:
        pendingEffects: []
      contexts:
        - historySequence: []
          variables:
            score: 5
            lives: 3
  - item:
      sectionId: "intro"
out:
  global:
    pendingEffects:
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "intro"
          initialState:
            score: 5
            lives: 3
          lines: []
      variables:
        score: 5
        lives: 3
---
case: add item to history with existing items
in:
  - state:
      global:
        pendingEffects: []
      contexts:
        - historySequence:
            - sectionId: "intro"
              initialState: {}
              lines: []
          variables:
            playerName: "Alice"
  - item:
      sectionId: "chapter1"
out:
  global:
    pendingEffects:
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "intro"
          initialState: {}
          lines: []
        - sectionId: "chapter1"
          initialState:
            playerName: "Alice"
          lines: []
      variables:
        playerName: "Alice"
---
case: add item to history with multiple contexts (should add to last one)
in:
  - state:
      global:
        pendingEffects: []
      contexts:
        - historySequence:
            - sectionId: "chapter1"
              initialState: {}
              lines: []
          variables:
            contextOneVar: 100
        - historySequence:
            - sectionId: "menu"
              initialState: {}
              lines: []
          variables:
            contextTwoVar: 200
  - item:
      sectionId: "options"
out:
  global:
    pendingEffects:
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "chapter1"
          initialState: {}
          lines: []
      variables:
        contextOneVar: 100
    - historySequence:
        - sectionId: "menu"
          initialState: {}
          lines: []
        - sectionId: "options"
          initialState:
            contextTwoVar: 200
          lines: []
      variables:
        contextTwoVar: 200
---
case: add item to history with existing pending effects
in:
  - state:
      global:
        pendingEffects:
          - name: "existingEffect"
            data: "test"
      contexts:
        - historySequence: []
          variables: {}
  - item:
      sectionId: "intro"
out:
  global:
    pendingEffects:
      - name: "existingEffect"
        data: "test"
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "intro"
          initialState: {}
          lines: []
      variables: {}
---
case: captures initialState with context variables at section entry
in:
  - state:
      global:
        pendingEffects: []
      contexts:
        - historySequence: []
          variables:
            health: 100
            mana: 50
            gold: 0
  - item:
      sectionId: "section1"
out:
  global:
    pendingEffects:
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "section1"
          initialState:
            health: 100
            mana: 50
            gold: 0
          lines: []
      variables:
        health: 100
        mana: 50
        gold: 0
---
case: initializes empty lines array for line-level tracking
in:
  - state:
      global:
        pendingEffects: []
      contexts:
        - historySequence: []
          variables:
            testVar: "value"
  - item:
      sectionId: "testSection"
out:
  global:
    pendingEffects:
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "testSection"
          initialState:
            testVar: "value"
          lines: []
      variables:
        testVar: "value"
---
case: captures initialState as shallow copy (independent of original variables)
in:
  - state:
      global:
        pendingEffects: []
      contexts:
        - historySequence: []
          variables:
            counter: 0
  - item:
      sectionId: "newSection"
out:
  global:
    pendingEffects:
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "newSection"
          initialState:
            counter: 0
          lines: []
      variables:
        counter: 0
---
case: captures empty initialState when no context variables
in:
  - state:
      global:
        pendingEffects: []
      contexts:
        - historySequence: []
          variables: {}
  - item:
      sectionId: "emptySection"
out:
  global:
    pendingEffects:
      - name: "render"
  contexts:
    - historySequence:
        - sectionId: "emptySection"
          initialState: {}
          lines: []
      variables: {}
